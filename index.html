<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Hafƒ±za E≈üle≈ütirme ‚Äî Candy Crush Light</title>
  <style>
    :root {
      --accent:#f77f00;
      --bg-a:#ff6f61; --bg-b:#6a5acd; --bg-c:#00b4d8; --bg-d:#ffd166;
    }
    html,body {
      margin:0; padding:0; height:100%;
      font-family: Arial, Helvetica, sans-serif; color:#fff;
      overflow-x:hidden; background:#111;
    }
    body {
      background: linear-gradient(270deg, var(--bg-a), var(--bg-b), var(--bg-c), var(--bg-d));
      background-size: 800% 800%;
      animation: gradientFlow 24s ease infinite;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    canvas#bubbles {
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;             /* üü° Artƒ±k arkada deƒüil, degrade √ºst√ºnde */
  pointer-events:none;
  opacity:.6;
}

    #menu {
      position:fixed; inset:0; display:flex; flex-direction:column; gap:14px;
      justify-content:center; align-items:center; text-align:center;
      background:rgba(0,0,0,.45); backdrop-filter: blur(8px); z-index:5;
    }
    #menu h1 { margin:0 0 6px 0; font-size:28px }
    #menu p { margin:0 0 14px 0; opacity:.9 }
    .menu-btn {
      background:var(--accent); color:#fff; border:none; cursor:pointer;
      padding:12px 22px; border-radius:12px; font-size:18px; width:220px;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    #header {
      position:sticky; top:0; z-index:4; display:none;
      background: rgba(0,0,0,.55); backdrop-filter: blur(6px);
      padding:10px; display:flex; gap:10px; align-items:center; justify-content:center;
      box-shadow:0 2px 10px rgba(0,0,0,.25);
    }
    .badge {
      display:inline-flex; align-items:center; gap:8px;
      background:#00000066; border:1px solid #ffffff29;
      padding:6px 10px; border-radius:999px; font-weight:700; font-size:14px;
    }
    .sound-btn {
      margin-left:8px; background:#ffffff22; border:1px solid #ffffff33; color:#fff;
      padding:6px 10px; border-radius:999px; cursor:pointer; font-size:14px;
    }
    #board {
      display:none;
      grid-template-columns: repeat(3, 1fr);
      gap:10px; padding:12px; justify-items:center;
      height: calc(100dvh - 70px); overflow-y:auto;
      position: relative;
      z-index: 1;
    }
    .card {
      width:30vw; max-width:120px; aspect-ratio:1/1;
      border-radius:14px; overflow:hidden; cursor:pointer; perspective:900px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .inner {
      width:100%; height:100%; transform-style:preserve-3d;
      transition: transform .38s cubic-bezier(.2,.8,.2,1), filter .2s;
    }
    .flipped .inner { transform: rotateY(180deg); }
    .front, .back {
      position:absolute; inset:0; backface-visibility:hidden; border-radius:14px;
    }
    .front { transform: rotateY(180deg); }
    .front img { width:100%; height:100%; object-fit:cover; }
    .back {
      background-color:#d62828;
      background-image:
        repeating-linear-gradient(45deg, #fff 0px, #fff 3px, transparent 3px, transparent 10px),
        repeating-linear-gradient(-45deg, #fff 0px, #fff 3px, transparent 3px, transparent 10px);
      background-size:20px 20px; border:2px solid #fff;
    }
    .matched {
      pointer-events:none; border:3px solid #32d74b; filter:brightness(1.2);
      animation: zoomFlash .6s ease both;
    }
    @keyframes zoomFlash {
      0%{ transform: scale(1) }
      40%{ transform: scale(1.25); box-shadow:0 0 18px #32d74b }
      100%{ transform: scale(1); box-shadow:none }
    }
    #toast {
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background:#00000070; backdrop-filter: blur(4px);
      padding:10px 14px; border-radius:999px; display:none; gap:8px; align-items:center; z-index:6;
      border:1px solid #ffffff2e;
    }
    #leaderboardPopup {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.7); backdrop-filter: blur(6px); z-index:10;
    }
    #leaderboardBox {
      width:min(90%,360px); background:#141414; border-radius:14px; padding:18px;
      box-shadow:0 0 24px rgba(0,0,0,.4); text-align:center; border:1px solid #ffffff22;
    }
    #leaderboardBox h2 { margin:4px 0 12px 0; color:var(--accent) }
    #leaderboardBox ol { text-align:left; padding-left:18px; margin:0 0 10px 0 }
    .btn {
      background:var(--accent); color:#fff; border:none; border-radius:10px;
      padding:10px 14px; font-size:16px; cursor:pointer;
    }
    canvas#confetti { position:fixed; inset:0; pointer-events:none; z-index:9; display:none; }
    @media (max-width:360px) { .card { max-width:106px } }
  </style>
</head>
<body>

<canvas id="bubbles"></canvas>
<canvas id="confetti"></canvas>

<section id="menu">
  <h1>üß† Hafƒ±za E≈üle≈ütirme</h1>
  <p>10 seviye ¬∑ yumu≈üak animasyonlar ¬∑ hafif & hƒ±zlƒ±</p>
  <button class="menu-btn" id="playBtn">üéÆ Oyuna Ba≈üla</button>
  <button class="menu-btn" id="showScoresBtn">üèÜ Rekorlar</button>
</section>

<header id="header" style="display:none">
  <div class="badge">Seviye: <span id="levelDisplay">1</span></div>
  <div class="badge">Puan: <span id="scoreDisplay">0</span></div>
  <button class="sound-btn" id="soundToggle">üîä Ses: A√ßƒ±k</button>
</header>

<main id="board"></main>

<div id="toast">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</div>

<div id="leaderboardPopup">
  <div id="leaderboardBox">
    <h2>üèÜ Yeni Rekor!</h2>
    <ol id="leaderList"></ol>
    <button class="btn" id="closePopup">Kapat</button>
  </div>
</div>

<audio id="flipSound" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5d0c1c3b4b.mp3?filename=pop-94319.mp3"></audio>
<audio id="matchSound" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d4d86a64f7.mp3?filename=soft-notification-102131.mp3"></audio>
<audio id="levelUpSound" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2d8a6e8241.mp3?filename=success-1-6297.mp3"></audio>

<script>
/* OYUN AYARLARI */
const IMAGE_PATH = "./images/";  // Bu senin repo yapƒ±sƒ±na uygun g√∂r√ºn√ºyordu
const TOTAL_IMAGES = 41;
const TOTAL_LEVELS = 10;
const MATCH_SCORE = 10;
const FAIL_PENALTY = 2;

/* DURUMLAR */
let level = 1, score = 0, flipped = [], matchedPairs = 0, mistakes = 0;
let soundOn = true;

const board = document.getElementById('board');
const levelEl = document.getElementById('levelDisplay');
const scoreEl = document.getElementById('scoreDisplay');
const menu = document.getElementById('menu');
const playBtn = document.getElementById('playBtn');
const showScoresBtn = document.getElementById('showScoresBtn');
const soundToggle = document.getElementById('soundToggle');
const toast = document.getElementById('toast');

const flipSound = document.getElementById('flipSound');
const matchSound = document.getElementById('matchSound');
const levelUpSound = document.getElementById('levelUpSound');

/* SES Y√ñNETƒ∞Mƒ∞ */
function setSound(on){
  soundOn = on;
  [flipSound, matchSound, levelUpSound].forEach(a => a.muted = !on);
  soundToggle.textContent = on ? "üîä Ses: A√ßƒ±k" : "üîá Ses: Kapalƒ±";
}
soundToggle.addEventListener('click', ()=> setSound(!soundOn));
document.body.addEventListener('click', enableAudioOnce, {once:true});
function enableAudioOnce(){
  [flipSound, matchSound, levelUpSound].forEach(a=>{
    a.volume=0;
    a.play().catch(()=>{});
    setTimeout(()=>{ a.pause(); a.currentTime = 0; a.volume = 1; }, 50);
  });
}

/* ANA MEN√ú */
playBtn.addEventListener('click', startGame);
showScoresBtn.addEventListener('click', showLeaderboardPopupOnly);
function startGame(){
  menu.style.display = 'none';
  document.getElementById('header').style.display = 'flex';
  board.style.display = 'grid';
  level = 1; score = 0;
  startLevel();
}
function returnToMenu(){
  menu.style.display = 'flex';
  document.getElementById('header').style.display = 'none';
  board.style.display = 'none';
}

/* SEVƒ∞YE BA≈ûLATMA */
function startLevel(){
  levelEl.textContent = level;
  scoreEl.textContent = score;
  mistakes = 0;
  flipped = [];
  matchedPairs = 0;

  const pairCount = level + 1;
  const selected = pickUniqueRandomImages(pairCount);
  const cards = shuffle([...selected, ...selected]);
  renderBoard(cards);
}
function pickUniqueRandomImages(count){
  const available = Array.from({length:TOTAL_IMAGES}, (_,i)=> `${IMAGE_PATH}${i+1}.jpg`);
  const out = [];
  while(out.length < count && available.length > 0){
    const idx = Math.floor(Math.random() * available.length);
    out.push(available.splice(idx, 1)[0]);
  }
  return out;
}
function renderBoard(cards){
  board.innerHTML = '';
  cards.forEach(src => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="inner">
        <div class="front"><img src="${src}" alt=""></div>
        <div class="back"></div>
      </div>`;
    card.addEventListener('click', ()=> flipCard(card, src));
    board.appendChild(card);
  });
}

/* KART MANTIƒûI */
function flipCard(card, src){
  if (card.classList.contains('flipped') || flipped.length === 2) return;

  if (soundOn){ flipSound.currentTime = 0; flipSound.play().catch(()=>{}); }
  card.classList.add('flipped');
  flipped.push({card, src});

  if (flipped.length === 2){
    const [a, b] = flipped;
    if (a.src === b.src) {
      setTimeout(()=>{
        if (soundOn){ matchSound.currentTime = 0; matchSound.play().catch(()=>{}); }
        a.card.classList.add('matched');
        b.card.classList.add('matched');
        flipped = [];
        matchedPairs++;
        score += MATCH_SCORE;
        scoreEl.textContent = score;

        if (matchedPairs === (level + 1)) {
          setTimeout(()=> levelComplete(), 350);
        }
      }, 280);
    } else {
      mistakes++;
      score = Math.max(0, score - FAIL_PENALTY);
      scoreEl.textContent = score;
      setTimeout(()=>{
        a.card.classList.remove('flipped');
        b.card.classList.remove('flipped');
        flipped = [];
      }, 650);
    }
  }
}

/* SEVƒ∞YE Bƒ∞TTƒ∞ */
function levelComplete(){
  const stars = mistakes <= 2 ? 3 : (mistakes <=5 ? 2 : 1);
  showToastStars(stars);
  fireConfetti(900);
  if (soundOn){ levelUpSound.currentTime = 0; levelUpSound.play().catch(()=>{}); }

  level++;
  if (level > TOTAL_LEVELS) {
    const broke = saveScore();
    if (broke) showLeaderboardPopup();
    alert(`üéâ Oyun bitti!\nToplam puan: ${score}`);
    returnToMenu();
  } else {
    setTimeout(()=> startLevel(), 1000);
  }
}
function showToastStars(n){
  toast.textContent = '‚≠ê'.repeat(n);
  toast.style.display = 'inline-flex';
  setTimeout(()=> toast.style.display = 'none', 1200);
}

/* Lƒ∞DER TABLOSU */
function saveScore(){
  let scores = JSON.parse(localStorage.getItem('leaderboard')||'[]');
  const name = prompt('ƒ∞smini yaz üìù') || 'Oyuncu';
  scores.push({name, score});
  scores.sort((a,b)=> b.score - a.score);
  const broke = scores.findIndex(s=> s.name===name && s.score===score) < 5;
  scores = scores.slice(0,5);
  localStorage.setItem('leaderboard', JSON.stringify(scores));
  return broke;
}
function showLeaderboardPopup(){
  const scores = JSON.parse(localStorage.getItem('leaderboard')||'[]');
  const list = document.getElementById('leaderList');
  list.innerHTML = scores.map(s=> `<li>${s.name}: ${s.score} puan</li>`).join('');
  document.getElementById('leaderboardPopup').style.display = 'flex';
}
function showLeaderboardPopupOnly(){
  const scores = JSON.parse(localStorage.getItem('leaderboard')||'[]');
  if (!scores.length) { alert('Hen√ºz kayƒ±tlƒ± bir rekor yok.'); return; }
  showLeaderboardPopup();
}
document.getElementById('closePopup').addEventListener('click', ()=>{
  document.getElementById('leaderboardPopup').style.display = 'none';
});

/* KARMA ASIL */
function shuffle(arr){
  let a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* BALON ANƒ∞MASYONU */
const bubbleCanvas = document.getElementById('bubbles');
const bctx = bubbleCanvas.getContext('2d');
let bubbles = [];
function resizeBubbles(){
  bubbleCanvas.width = window.innerWidth;
  bubbleCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeBubbles); resizeBubbles();
const BUBBLE_COUNT = 48;
for (let i = 0; i < BUBBLE_COUNT; i++){
  bubbles.push({
    x: Math.random()*bubbleCanvas.width,
    y: Math.random()*bubbleCanvas.height,
    r: Math.random()*10+6,
    s: Math.random()*0.6+0.25,
    a: Math.random()*0.5+0.25
  });
}
function drawBubbles(){
  bctx.clearRect(0,0,bubbleCanvas.width,bubbleCanvas.height);
  bubbles.forEach(b=>{
    bctx.beginPath();
    bctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
    bctx.fillStyle = `rgba(255,255,255,${b.a})`;
    bctx.fill();
    b.y -= b.s;
    if (b.y + b.r < 0){
      b.y = bubbleCanvas.height + b.r;
      b.x = Math.random()*bubbleCanvas.width;
    }
  });
  requestAnimationFrame(drawBubbles);
}
drawBubbles();

/* KONFETƒ∞ */
const confettiCanvas = document.getElementById('confetti');
const cctx = confettiCanvas.getContext('2d');
let confetti = [];
function resizeConfetti(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeConfetti); resizeConfetti();
function fireConfetti(ms=1000){
  confettiCanvas.style.display='block';
  confetti = [];
  const colors = ['#ff477e','#ffd166','#06d6a0','#118ab2','#ffe66d'];
  for (let i = 0; i < 150; i++){
    confetti.push({
      x: Math.random()*confettiCanvas.width,
      y: -20,
      w: Math.random()*6+4,
      h: Math.random()*10+6,
      vy: Math.random()*2+2,
      vx: (Math.random()-0.5)*2,
      rot: Math.random()*360,
      vr: (Math.random()-0.5)*6,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }
  const start = performance.now();
  function tick(t){
    cctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    confetti.forEach(p=>{
      p.y += p.vy; p.x += p.vx; p.rot += p.vr;
      cctx.save();
      cctx.translate(p.x, p.y);
      cctx.rotate(p.rot*Math.PI/180);
      cctx.fillStyle = p.color;
      cctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      cctx.restore();
    });
    if (t - start < ms) requestAnimationFrame(tick);
    else confettiCanvas.style.display = 'none';
  }
  requestAnimationFrame(tick);
}

/* BA≈ûLAT */
setSound(true);
</script>
</body>
</html>
