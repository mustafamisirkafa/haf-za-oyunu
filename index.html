<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>üß† Hafƒ±za Oyunu ‚Äî Dinamik Boy Fix</title>
<style>
:root {
  --accent:#f77f00;
  --bg-a:#ff6f61;--bg-b:#6a5acd;--bg-c:#00b4d8;--bg-d:#ffd166;
}
html,body{
  margin:0;padding:0;height:100%;
  font-family:Arial,Helvetica,sans-serif;color:#fff;background:#111;
  overflow:hidden;
}
body{
  background:linear-gradient(270deg,var(--bg-a),var(--bg-b),var(--bg-c),var(--bg-d));
  background-size:800% 800%;
  animation:gradientFlow 24s ease infinite;
}
@keyframes gradientFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

canvas#bubbles{position:fixed;inset:0;width:100%;height:100%;z-index:-1;pointer-events:none;opacity:.5;}

#menu{
  position:fixed;inset:0;display:flex;flex-direction:column;gap:14px;
  justify-content:center;align-items:center;text-align:center;
  background:rgba(0,0,0,.45);backdrop-filter:blur(8px);z-index:5;
}
.menu-btn{
  background:var(--accent);color:#fff;border:none;cursor:pointer;
  padding:12px 22px;border-radius:12px;font-size:18px;width:240px;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}

#header{
  position:absolute;top:0;left:0;width:100%;
  display:none;justify-content:center;align-items:center;gap:10px;
  background:rgba(0,0,0,.55);backdrop-filter:blur(6px);
  padding:8px;z-index:4;
}
.badge{
  background:#00000066;border:1px solid #ffffff29;padding:6px 10px;
  border-radius:999px;font-weight:700;font-size:14px;
}
.sound-btn,.pause-btn{
  background:#ffffff22;border:1px solid #ffffff33;color:#fff;
  padding:6px 10px;border-radius:999px;cursor:pointer;font-size:14px;
}

#board{
  display:grid;
  justify-content:center;align-content:center;
  width:100vw;
  box-sizing:border-box;
  gap:1vw;
  position:absolute;
  left:0;
  z-index:1;
  padding:1vw;
  transition:all .2s;
}

.card{
  border-radius:12px;overflow:hidden;cursor:pointer;perspective:900px;
  background:#000;box-shadow:0 6px 18px rgba(0,0,0,.25);
}
.inner{width:100%;height:100%;transform-style:preserve-3d;
  transition:transform .38s cubic-bezier(.2,.8,.2,1);}
.flipped .inner{transform:rotateY(180deg);}
.front,.back{
  position:absolute;inset:0;backface-visibility:hidden;border-radius:12px;
}
.front{transform:rotateY(180deg);}
.front img{width:100%;height:100%;object-fit:cover;display:block;background:#222;}
.back{
  background-color:#d62828;
  background-image:repeating-linear-gradient(45deg,#fff 0px,#fff 3px,transparent 3px,transparent 10px),
                   repeating-linear-gradient(-45deg,#fff 0px,#fff 3px,transparent 3px,transparent 10px);
  background-size:20px 20px;border:2px solid #fff;
}
.matched{pointer-events:none;border:3px solid #32d74b;filter:brightness(1.2);animation:zoomFlash .6s ease both;}
@keyframes zoomFlash{0%{transform:scale(1)}40%{transform:scale(1.25)}100%{transform:scale(1)}}

#pauseMenu{
  position:fixed;inset:0;display:none;flex-direction:column;gap:14px;
  justify-content:center;align-items:center;text-align:center;
  background:rgba(0,0,0,.65);backdrop-filter:blur(8px);z-index:7;
}

canvas#confetti{position:fixed;inset:0;pointer-events:none;z-index:9;display:none;}
</style>
</head>
<body>
<canvas id="bubbles"></canvas>
<canvas id="confetti"></canvas>

<section id="menu">
  <h1>üß† Hafƒ±za Oyunu</h1>
  <p>43 resim ¬∑ tam ekran ¬∑ sesli</p>
  <button class="menu-btn" onclick="startGame(12)">üü¢ Kolay (12 Kart)</button>
  <button class="menu-btn" onclick="startGame(18)">üü† Orta (18 Kart)</button>
  <button class="menu-btn" onclick="startGame(24)">üî¥ Zor (24 Kart)</button>
</section>

<header id="header">
  <div class="badge">Puan: <span id="scoreDisplay">0</span></div>
  <button class="sound-btn" id="soundToggle">üîä Ses: A√ßƒ±k</button>
  <button class="pause-btn" id="pauseBtn">‚è∏</button>
</header>

<main id="board"></main>

<div id="pauseMenu">
  <button class="menu-btn" id="resumeBtn">‚ñ∂Ô∏è Devam Et</button>
  <button class="menu-btn" id="quitBtn">üè† Ana Men√º</button>
</div>

<audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5d0c1c3b4b.mp3?filename=pop-94319.mp3"></audio>
<audio id="matchSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d4d86a64f7.mp3?filename=soft-notification-102131.mp3"></audio>
<audio id="levelUpSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2d8a6e8241.mp3?filename=success-1-6297.mp3"></audio>

<script>
const IMAGE_PATH="./images/";
const TOTAL_IMAGES=43;
const MATCH_SCORE=10, FAIL_PENALTY=2;
let flipped=[],matchedPairs=0,score=0,soundOn=true,paused=false,cardCount=12;

const board=document.getElementById('board'),
      menu=document.getElementById('menu'),
      header=document.getElementById('header'),
      pauseMenu=document.getElementById('pauseMenu'),
      scoreEl=document.getElementById('scoreDisplay'),
      soundToggle=document.getElementById('soundToggle'),
      pauseBtn=document.getElementById('pauseBtn'),
      resumeBtn=document.getElementById('resumeBtn'),
      quitBtn=document.getElementById('quitBtn'),
      flipSound=document.getElementById('flipSound'),
      matchSound=document.getElementById('matchSound'),
      levelUpSound=document.getElementById('levelUpSound');

soundToggle.addEventListener('click',()=>setSound(!soundOn));
pauseBtn.addEventListener('click',()=>{paused=true;pauseMenu.style.display='flex';});
resumeBtn.addEventListener('click',()=>{paused=false;pauseMenu.style.display='none';});
quitBtn.addEventListener('click',()=>returnToMenu());

function setSound(on){soundOn=on;[flipSound,matchSound,levelUpSound].forEach(a=>a.muted=!on);
  soundToggle.textContent=on?"üîä Ses: A√ßƒ±k":"üîá Ses: Kapalƒ±";}

function resetGameVars(){
  flipped=[];matchedPairs=0;score=0;paused=false;
  scoreEl.textContent=0;
}

function returnToMenu(){
  resetGameVars();
  board.innerHTML='';
  pauseMenu.style.display='none';
  header.style.display='none';
  menu.style.display='flex';
}

function startGame(count){
  resetGameVars();
  cardCount=count;
  menu.style.display='none';
  header.style.display='flex';
  renderBoard();
  adjustBoardSize();
  window.addEventListener('resize',adjustBoardSize);
}

function adjustBoardSize(){
  const headerH = header.offsetHeight;
  const totalH = window.innerHeight - headerH - 8; // üîß tam oturmasƒ± i√ßin
  board.style.top = headerH + "px";
  board.style.height = totalH + "px";
}

function renderBoard(){
  board.innerHTML='';
  const pairCount=cardCount/2;
  const selected=pickImages(pairCount);
  const cards=shuffle([...selected,...selected]);
  let cols,rows;
  if(cardCount===12){cols=3;rows=4;}
  else if(cardCount===18){cols=3;rows=6;}
  else{cols=4;rows=6;}
  board.style.gridTemplateColumns=`repeat(${cols},1fr)`;

  const boardH = window.innerHeight - header.offsetHeight - 16;
  const boardW = board.clientWidth;
  const hSize = (boardH - (rows+1)*8) / rows;
  const wSize = (boardW - (cols+1)*8) / cols;
  const size = Math.min(hSize, wSize);

  cards.forEach((src,i)=>{
    const card=document.createElement('div');
    card.className='card';
    card.dataset.src=src;
    card.style.width=size+'px';
    card.style.height=size+'px';
    card.innerHTML=`<div class="inner">
      <div class="front"><img src="${src}" alt="img-${i}"></div>
      <div class="back"></div>
    </div>`;
    card.addEventListener('click',()=>flipCard(card));
    board.appendChild(card);
  });
}

function pickImages(count){
  const all=Array.from({length:TOTAL_IMAGES},(_,i)=>`${IMAGE_PATH}${i+1}.jpg`);
  const chosen=[];while(chosen.length<count&&all.length>0){
    const idx=Math.floor(Math.random()*all.length);
    chosen.push(all.splice(idx,1)[0]);
  }
  return chosen;
}

function flipCard(card){
  if(paused)return;
  if(card.classList.contains('flipped')||flipped.length===2)return;
  if(soundOn){flipSound.currentTime=0;flipSound.play().catch(()=>{});}
  card.classList.add('flipped');
  flipped.push(card);
  if(flipped.length===2){
    const[a,b]=flipped;
    if(a.dataset.src===b.dataset.src){
      setTimeout(()=>{
        if(soundOn){matchSound.currentTime=0;matchSound.play().catch(()=>{});}
        a.classList.add('matched');b.classList.add('matched');
        flipped=[];matchedPairs++;score+=MATCH_SCORE;scoreEl.textContent=score;
        if(matchedPairs===cardCount/2)setTimeout(levelComplete,400);
      },250);
    }else{
      score=Math.max(0,score-FAIL_PENALTY);scoreEl.textContent=score;
      setTimeout(()=>{a.classList.remove('flipped');b.classList.remove('flipped');flipped=[];},1500);
    }
  }
}

function levelComplete(){
  if(soundOn){levelUpSound.currentTime=0;levelUpSound.play().catch(()=>{});}
  alert(`üéâ Tebrikler! ${cardCount} kartƒ± tamamladƒ±n.\nToplam Puan: ${score}`);
  returnToMenu();
}

function shuffle(arr){let a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

/* Baloncuk efekti */
const bubbleCanvas=document.getElementById('bubbles'),bctx=bubbleCanvas.getContext('2d');
function resizeBubbles(){bubbleCanvas.width=window.innerWidth;bubbleCanvas.height=window.innerHeight;}
window.addEventListener('resize',resizeBubbles);resizeBubbles();
const bubbles=Array.from({length:48},()=>({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,r:Math.random()*10+6,s:Math.random()*0.6+0.25,a:Math.random()*0.5+0.25}));
function drawBubbles(){
  bctx.clearRect(0,0,bubbleCanvas.width,bubbleCanvas.height);
  bubbles.forEach(b=>{
    bctx.beginPath();bctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    bctx.fillStyle=`rgba(255,255,255,${b.a})`;bctx.fill();
    b.y-=b.s;if(b.y+b.r<0){b.y=bubbleCanvas.height+b.r;b.x=Math.random()*bubbleCanvas.width;}
  });
  requestAnimationFrame(drawBubbles);
}
drawBubbles();
setSound(true);
</script>
</body>
</html>
