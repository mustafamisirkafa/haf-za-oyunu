<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß† Hafƒ±za E≈üle≈ütirme Oyunu</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: white;
    }

    canvas#particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    #header {
      text-align: center;
      padding: 10px;
      background: rgba(0,0,0,0.6);
      position: sticky;
      top: 0;
      z-index: 5;
      backdrop-filter: blur(6px);
    }

    h1 {
      margin: 5px 0;
      font-size: 22px;
    }

    #levelDisplay, #scoreDisplay {
      display: inline-block;
      background: #f77f00;
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 16px;
      margin: 5px;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 10px;
      justify-items: center;
    }

    .card {
      width: 30vw;
      max-width: 120px;
      aspect-ratio: 1/1;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      perspective: 800px;
    }

    .inner {
      width: 100%;
      height: 100%;
      transition: transform 0.4s;
      transform-style: preserve-3d;
      position: relative;
    }

    .flipped .inner {
      transform: rotateY(180deg);
    }

    .front, .back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
    }

    .front {
      transform: rotateY(180deg);
    }

    .front img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .back {
      background-color: #d62828;
      background-image:
        repeating-linear-gradient(45deg, white 0px, white 3px, transparent 3px, transparent 10px),
        repeating-linear-gradient(-45deg, white 0px, white 3px, transparent 3px, transparent 10px);
      background-size: 20px 20px;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }

    .matched {
      pointer-events: none;
      animation: zoomFlash 0.6s ease;
      filter: brightness(1.3);
      border: 3px solid limegreen;
    }

    @keyframes zoomFlash {
      0% { transform: scale(1); }
      40% { transform: scale(1.3); box-shadow: 0 0 15px limegreen; }
      100% { transform: scale(1); box-shadow: none; }
    }

    #leaderboard {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      margin: 10px auto;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
    }

    #leaderboard h2 {
      margin-top: 0;
      text-align: center;
      font-size: 18px;
    }

    #leaderboard ol {
      padding-left: 20px;
    }

    #leaderboard li {
      margin: 4px 0;
    }
  </style>
</head>
<body>

<canvas id="particles"></canvas>

<div id="header">
  <h1>üß† Hafƒ±za E≈üle≈ütirme Oyunu</h1>
  <div id="levelDisplay">Seviye: 1</div>
  <div id="scoreDisplay">Puan: 0</div>
</div>

<div id="board"></div>

<div id="leaderboard">
  <h2>üèÜ Lider Tablosu</h2>
  <ol id="leaderList"></ol>
</div>

<audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5d0c1c3b4b.mp3?filename=pop-94319.mp3"></audio>
<audio id="matchSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d4d86a64f7.mp3?filename=soft-notification-102131.mp3"></audio>

<script>
const IMAGE_PATH = "./images/";
const TOTAL_IMAGES = 41;
const TOTAL_LEVELS = 10;

let level = 1;
let flippedCards = [];
let matchedPairs = 0;
let score = 0;
let usedImages = [];

const flipSound = document.getElementById('flipSound');
const matchSound = document.getElementById('matchSound');

function startLevel() {
  document.getElementById('levelDisplay').textContent = `Seviye: ${level}`;
  document.getElementById('scoreDisplay').textContent = `Puan: ${score}`;
  const pairCount = level + 1;
  const selected = pickUniqueRandomImages(pairCount);
  const cards = shuffle([...selected, ...selected]);
  renderBoard(cards);
}

function pickUniqueRandomImages(count) {
  const available = Array.from({length: TOTAL_IMAGES}, (_, i) => `${IMAGE_PATH}${i+1}.jpg`);
  const picked = [];
  while (picked.length < count) {
    const img = available.splice(Math.floor(Math.random() * available.length), 1)[0];
    picked.push(img);
  }
  return picked;
}

function renderBoard(cards) {
  const board = document.getElementById('board');
  board.innerHTML = '';
  flippedCards = [];
  matchedPairs = 0;

  cards.forEach(src => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="inner">
        <div class="front"><img src="${src}" alt=""></div>
        <div class="back"></div>
      </div>
    `;
    card.addEventListener('click', () => flipCard(card, src));
    board.appendChild(card);
  });
}

function flipCard(card, src) {
  if (card.classList.contains('flipped') || flippedCards.length === 2) return;
  flipSound.currentTime = 0; flipSound.play();
  card.classList.add('flipped');
  flippedCards.push({card, src});

  if (flippedCards.length === 2) {
    const [a, b] = flippedCards;
    if (a.src === b.src) {
      setTimeout(() => {
        matchSound.currentTime = 0; matchSound.play();
        a.card.classList.add('matched');
        b.card.classList.add('matched');
        score += 10;
        matchedPairs++;
        flippedCards = [];
        updateScore();
        if (matchedPairs === level + 1) {
          setTimeout(nextLevel, 1000);
        }
      }, 400);
    } else {
      score -= 2;
      updateScore();
      setTimeout(() => {
        a.card.classList.remove('flipped');
        b.card.classList.remove('flipped');
        flippedCards = [];
      }, 800);
    }
  }
}

function updateScore() {
  document.getElementById('scoreDisplay').textContent = `Puan: ${score}`;
}

function nextLevel() {
  level++;
  if (level > TOTAL_LEVELS) {
    saveScore();
    alert("üéâ T√ºm seviyeleri bitirdin!");
    level = 1;
    score = 0;
  }
  startLevel();
}

function shuffle(array) {
  let arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* üèÜ Lider Tablosu */
function saveScore() {
  let scores = JSON.parse(localStorage.getItem('leaderboard') || "[]");
  const name = prompt("ƒ∞smini gir üìù") || "Oyuncu";
  scores.push({name, score});
  scores.sort((a,b) => b.score - a.score);
  scores = scores.slice(0, 5);
  localStorage.setItem('leaderboard', JSON.stringify(scores));
  renderLeaderboard();
}

function renderLeaderboard() {
  const scores = JSON.parse(localStorage.getItem('leaderboard') || "[]");
  const list = document.getElementById('leaderList');
  list.innerHTML = scores.map(s => `<li>${s.name}: ${s.score} puan</li>`).join('');
}

/* üéá Partik√ºl Arka Plan */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

for (let i = 0; i < 80; i++) {
  particles.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 2 + 1,
    dx: (Math.random() - 0.5) * 0.5,
    dy: (Math.random() - 0.5) * 0.5
  });
}

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'rgba(255,255,255,0.8)';
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
    if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
  });
  requestAnimationFrame(drawParticles);
}
drawParticles();

renderLeaderboard();
startLevel();
</script>

</body>
</html>
